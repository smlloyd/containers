FROM registry.redhat.io/rhel9/rhel-bootc:latest@sha256:850d33e80b19a6ffae0585c2be4ff1258c11c939cbbfe6f007115702f0ec3676

USER root

# 1. Prevent subscription-manager from automatically re-enabling its dnf plugin
# 2. Kill the 'container-mode' trigger file
# 3. Force the plugin to stay disabled
RUN subscription-manager config --rhsm.auto_enable_yum_plugins=0 && \
    rm -f /etc/rhsm-host && \
    sed -i 's/enabled=1/enabled=0/g' /etc/yum/pluginconf.d/subscription-manager.conf

COPY ./bootc/rhel9/etc /etc/
RUN systemctl disable kdump
RUN dnf -y install rhc dnf-plugins-core vim zsh tmux systemd-resolved tuned
RUN dnf clean all
RUN systemctl enable systemd-resolved.service
